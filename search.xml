<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Shell脚本自动部署二进制MySQL数据库</title>
    <url>/post/Shell%E8%84%9A%E6%9C%AC%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E4%BA%8C%E8%BF%9B%E5%88%B6MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>该Shell脚本为MYSQL CLUSTER集群中自动部署二进制包MySQL数据库，配置参数为集群参数，可修改成单节点配置，脚本还有功能尚未完成，但依旧不影响使用。</p>
<span id="more"></span>

<h2 id="脚本的逻辑"><a href="#脚本的逻辑" class="headerlink" title="脚本的逻辑"></a>脚本的逻辑</h2><ul>
<li>数据库二进制安装</li>
<li>系统环境配置</li>
<li>数据库配置文件my.cnf配置</li>
<li>数据库初始化</li>
<li>安装完成<br>该脚本部署用户为普通用户，且没有重新添加MySQL用户，可选择是否新建使用MySQL用户安装</li>
</ul>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><h3 id="部署脚本"><a href="#部署脚本" class="headerlink" title="部署脚本"></a>部署脚本</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#mysql二进制自动安装脚本</span></span><br><span class="line"><span class="comment">#注意：本脚本是用普通用户安装!!!</span></span><br><span class="line"><span class="comment">#1.为保证三台虚拟机上可正常通过名称解析到对方的IP，这里将主机名称映射必做写入三台主机的hosts文件中，需使用|root用户|添加主机名映射</span></span><br><span class="line"><span class="comment">#cat &lt;&lt; EOF &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="comment">#10.19.36.42   t1</span></span><br><span class="line"><span class="comment">#10.19.36.43   t2</span></span><br><span class="line"><span class="comment">#10.19.36.44   t3</span></span><br><span class="line"><span class="comment">#EOF</span></span><br><span class="line"><span class="comment">#2.在Redhat/CentOS7及以上版本操作系统安装，会默认安装mysql数据库，并自带生成/etc/my.cnf文件，为了方便编辑和管理，我们一般会使用|root用户|将/etc/my.cnf更名为/etc/my.cnfbak，mv /etc/my.cnf /etc/my.cnfbak</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装数据库用户</span></span><br><span class="line">USER=puaiuc</span><br><span class="line"><span class="comment">#MySQL安装包名</span></span><br><span class="line">BIN_PKG=mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line"><span class="comment">#MySQL安装目录，根据情况自行修改</span></span><br><span class="line">BASE_DIR=/data/test</span><br><span class="line"><span class="comment">#安装包的存放目录</span></span><br><span class="line">BIN_PKG_DIR=<span class="variable">$BASE_DIR</span>/<span class="variable">$BIN_PKG</span></span><br><span class="line"><span class="comment">#MySQL解压后路径</span></span><br><span class="line">MYSQL_PATH=<span class="variable">$BASE_DIR</span>/<span class="variable">$&#123;BIN_PKG%.tar*&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">########|my.cnf配置参数|##########</span></span><br><span class="line"><span class="comment">#数据库端口</span></span><br><span class="line">MYSQL_PORT=3366</span><br><span class="line"><span class="comment">#数据库会根据port自动生成，在port后面增加0</span></span><br><span class="line">MYSQLX_PORT=33660</span><br><span class="line"><span class="comment">#根据机器进行调整,操作系统内存的70%-80%最佳</span></span><br><span class="line">BUFFER_POOL_SIZE=20G</span><br><span class="line"><span class="comment">#集群中每个节点的ID不允许重复，否则报错，可设置为IP最后一位</span></span><br><span class="line">SERVER_ID=44</span><br><span class="line"><span class="comment">#数据组复制端口，建议在port后面加1；此为IP为本机IP地址</span></span><br><span class="line">GROUP_REPLICATION_LOCAL_ADDRESS=10.19.36.44:33661</span><br><span class="line"><span class="comment">#集群中所有数据库节点需要配置（此处无须配置本机的端口）</span></span><br><span class="line">GROUP_REPLICATION_GROUP_SEEDS=10.19.36.42:33661,10.19.36.43:33661</span><br><span class="line"><span class="comment"># 导入和导出操作专用目录,该目录需要提前先建好</span></span><br><span class="line">SECURE_FILE_PRIV=<span class="variable">$BASE_DIR</span>/dumpdir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">log_output</span></span>() &#123;</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;[INFO][<span class="subst">$(date +<span class="string">&quot;%F %T&quot;</span>)</span>] <span class="variable">$1</span> 成功!&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;[ERROR][<span class="subst">$(date +<span class="string">&quot;%F %T&quot;</span>)</span>] <span class="variable">$1</span> 失败! 已退出安装&quot;</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install_mysql</span></span>() &#123;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;正在安装<span class="variable">$&#123;BIN_PKG%.tar*&#125;</span>...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 mysql用户、组</span></span><br><span class="line"><span class="comment">#if ! grep -q &#x27;^mysql:&#x27; /etc/passwd ;then</span></span><br><span class="line"><span class="comment">#  useradd  -s /sbin/nologin -d $MYSQL_PATH mysql</span></span><br><span class="line"><span class="comment">#  log_output &quot;创建mysql用户&quot;</span></span><br><span class="line"><span class="comment">#fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压tar包到/usr/local/目录下</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;mysql二进制包正解压到<span class="variable">$&#123;BASE_DIR&#125;</span>目录下&quot;</span></span><br><span class="line">xz -d <span class="variable">$BIN_PKG</span>  &amp;&amp; tar -vxf <span class="variable">$&#123;BIN_PKG%.xz*&#125;</span> -C <span class="variable">$BASE_DIR</span></span><br><span class="line">log_output <span class="string">&quot;mysql二进制包解压&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置mysqld服务的环境变量</span></span><br><span class="line">result=`<span class="built_in">cat</span> ~/.bash_profile | grep mysql`</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$result</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="comment">#echo &quot;MYSQL_HOME=$MYSQL_PATH/bin:$PATH&quot; &gt;&gt; ~/.bash_profile &amp;&amp; source ~/.bash_profile</span></span><br><span class="line">  sed -i <span class="string">&quot;/^PATH/i export MYSQL_HOME=&#x27;<span class="variable">$MYSQL_PATH</span>&#x27;&quot;</span> -i ~/.bash_profile</span><br><span class="line">  sed -i <span class="string">&#x27;/^PATH/ s/$/:$&#123;MYSQL_HOME&#125;\/bin/&#x27;</span> ~/.bash_profile</span><br><span class="line">  <span class="built_in">source</span> ~/.bash_profile</span><br><span class="line">  log_output <span class="string">&quot;配置mysqld服务的环境变量&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;检测到mysqld服务的环境变量已配置好&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在部署用户目录下创建配置文件 ~/.my.cnf</span></span><br><span class="line"><span class="built_in">cat</span> &gt; ~/.my.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">port=$&#123;MYSQL_PORT&#125;</span></span><br><span class="line"><span class="string">socket=$&#123;MYSQL_PATH&#125;/mysqld.sock</span></span><br><span class="line"><span class="string">default-character-set=utf8mb4</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">port= $&#123;MYSQL_PORT&#125;</span></span><br><span class="line"><span class="string">#数据库最大连接数</span></span><br><span class="line"><span class="string">max_connections = 3000 </span></span><br><span class="line"><span class="string">max_connect_errors = 300</span></span><br><span class="line"><span class="string">datadir=$&#123;MYSQL_PATH&#125;/data</span></span><br><span class="line"><span class="string">socket=$&#123;MYSQL_PATH&#125;/mysqld.sock</span></span><br><span class="line"><span class="string">basedir=$&#123;MYSQL_PATH&#125;</span></span><br><span class="line"><span class="string">log-error=$&#123;MYSQL_PATH&#125;/mysqld.log</span></span><br><span class="line"><span class="string">pid-file=$&#123;MYSQL_PATH&#125;/mysqld.pid</span></span><br><span class="line"><span class="string">default-time-zone = &#x27;+08:00&#x27;</span></span><br><span class="line"><span class="string">lower_case_table_names = 1                                # 忽略大小写</span></span><br><span class="line"><span class="string">enforce_gtid_consistency = ON</span></span><br><span class="line"><span class="string">gtid_mode = ON</span></span><br><span class="line"><span class="string">binlog_checksum  = none</span></span><br><span class="line"><span class="string">default_authentication_plugin = mysql_native_password</span></span><br><span class="line"><span class="string">skip-name-resolve = ON</span></span><br><span class="line"><span class="string"># open_files_limit does not take effect</span></span><br><span class="line"><span class="string">open_files_limit = 65535                                  # 可用的文件描述符数</span></span><br><span class="line"><span class="string">table_open_cache = 2000</span></span><br><span class="line"><span class="string">#For safe write dir</span></span><br><span class="line"><span class="string">local_infile = 0</span></span><br><span class="line"><span class="string">#导入和导出操作专用目录,该目录需要提前先建好</span></span><br><span class="line"><span class="string">secure_file_priv = $&#123;SECURE_FILE_PRIV&#125;</span></span><br><span class="line"><span class="string">#################innodb########################</span></span><br><span class="line"><span class="string">innodb_data_home_dir = $&#123;MYSQL_PATH&#125;/data</span></span><br><span class="line"><span class="string">innodb_data_file_path = ibdata1:512M;ibdata2:512M:autoextend</span></span><br><span class="line"><span class="string">#根据机器进行调整,操作系统内存的70%-80%最佳</span></span><br><span class="line"><span class="string">innodb_buffer_pool_size = $&#123;BUFFER_POOL_SIZE&#125;</span></span><br><span class="line"><span class="string">innodb_flush_log_at_trx_commit = 2</span></span><br><span class="line"><span class="string">innodb_io_capacity = 2500</span></span><br><span class="line"><span class="string">innodb_lock_wait_timeout = 120</span></span><br><span class="line"><span class="string">innodb_log_buffer_size = 1G</span></span><br><span class="line"><span class="string">innodb_log_file_size = 2G</span></span><br><span class="line"><span class="string">innodb_log_files_in_group = 3</span></span><br><span class="line"><span class="string">innodb_max_dirty_pages_pct = 75</span></span><br><span class="line"><span class="string">innodb_read_io_threads = 6</span></span><br><span class="line"><span class="string">innodb_write_io_threads = 6</span></span><br><span class="line"><span class="string">innodb_thread_concurrency = 18</span></span><br><span class="line"><span class="string">innodb_file_per_table = 1</span></span><br><span class="line"><span class="string">innodb_flush_neighbors=1</span></span><br><span class="line"><span class="string">innodb_rollback_on_timeout</span></span><br><span class="line"><span class="string">innodb_undo_directory = $&#123;MYSQL_PATH&#125;/data                    # 重做日志文件的目录路径（最好是 SSD 盘）</span></span><br><span class="line"><span class="string">innodb_log_group_home_dir = $&#123;MYSQL_PATH&#125;/data</span></span><br><span class="line"><span class="string">###################session###########################</span></span><br><span class="line"><span class="string">join_buffer_size = 8M</span></span><br><span class="line"><span class="string">key_buffer_size = 256M                                        # MyISAM 索引块的缓冲区大小</span></span><br><span class="line"><span class="string">bulk_insert_buffer_size = 32M</span></span><br><span class="line"><span class="string">max_heap_table_size = 1G</span></span><br><span class="line"><span class="string">tmp_table_size = 1G</span></span><br><span class="line"><span class="string">read_buffer_size = 32M</span></span><br><span class="line"><span class="string">sort_buffer_size = 32M</span></span><br><span class="line"><span class="string">max_allowed_packet = 1G</span></span><br><span class="line"><span class="string">read_rnd_buffer_size = 32M</span></span><br><span class="line"><span class="string">############log set###################</span></span><br><span class="line"><span class="string">#集群中每个节点的ID不允许重复，否则报错</span></span><br><span class="line"><span class="string">server_id = $&#123;SERVER_ID&#125;</span></span><br><span class="line"><span class="string">log-error = mysqld.err</span></span><br><span class="line"><span class="string">log-bin = binlog</span></span><br><span class="line"><span class="string">log_bin_index = binlog.index</span></span><br><span class="line"><span class="string">max_binlog_size = 2G</span></span><br><span class="line"><span class="string">slow_query_log_file = $&#123;MYSQL_PATH&#125;/slow.log</span></span><br><span class="line"><span class="string">slow_query_log = 1</span></span><br><span class="line"><span class="string">long_query_time = 10</span></span><br><span class="line"><span class="string">log_queries_not_using_indexes = ON</span></span><br><span class="line"><span class="string">log_throttle_queries_not_using_indexes = 10</span></span><br><span class="line"><span class="string">log_slow_admin_statements = ON</span></span><br><span class="line"><span class="string">log_output = FILE,TABLE</span></span><br><span class="line"><span class="string">#master_info_file = $&#123;MYSQL_PATH&#125;/master.info</span></span><br><span class="line"><span class="string">master_info_repository=TABLE</span></span><br><span class="line"><span class="string">log_slave_updates=ON</span></span><br><span class="line"><span class="string">binlog_format=ROW</span></span><br><span class="line"><span class="string">binlog_rows_query_log_events=ON</span></span><br><span class="line"><span class="string">wait_timeout=28800                            # 服务器在关闭非交互式连接之前等待活动的秒数(默认8小时)</span></span><br><span class="line"><span class="string">slave_parallel_workers=48</span></span><br><span class="line"><span class="string">slave_parallel_type=LOGICAL_CLOCK</span></span><br><span class="line"><span class="string">slave_pending_jobs_size_max=1G</span></span><br><span class="line"><span class="string">slave_preserve_commit_order=ON</span></span><br><span class="line"><span class="string"># add new 20210706</span></span><br><span class="line"><span class="string">slave_compressed_protocol=ON</span></span><br><span class="line"><span class="string">transaction_isolation=&#x27;read-committed&#x27;</span></span><br><span class="line"><span class="string">innodb_buffer_pool_instances=64</span></span><br><span class="line"><span class="string">relay_log_info_repository=TABLE</span></span><br><span class="line"><span class="string">##########################mgr set##############################</span></span><br><span class="line"><span class="string">#数据库会根据port自动生成，在port后面增加0；不建议随便改</span></span><br><span class="line"><span class="string">mysqlx_port=$&#123;MYSQLX_PORT&#125;</span></span><br><span class="line"><span class="string">mysqlx_socket=$&#123;MYSQL_PATH&#125;/mysqlx.sock</span></span><br><span class="line"><span class="string">loose-group_replication_group_name=&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;</span></span><br><span class="line"><span class="string">loose-group_replication_start_on_boot=off</span></span><br><span class="line"><span class="string">#数据组复制端口，建议在port后面加1；此为IP为本机IP地址</span></span><br><span class="line"><span class="string">loose-group_replication_local_address= &quot;$&#123;GROUP_REPLICATION_LOCAL_ADDRESS&#125;&quot;</span></span><br><span class="line"><span class="string">#复制组的集群信息</span></span><br><span class="line"><span class="string">#集群中所有数据库节点需要配置（此处无须配置本机的端口）</span></span><br><span class="line"><span class="string">loose-group_replication_group_seeds= &quot;$&#123;GROUP_REPLICATION_GROUP_SEEDS&#125;&quot;</span></span><br><span class="line"><span class="string">loose-group_replication_bootstrap_group= off</span></span><br><span class="line"><span class="string">#loose-group_replication_ip_whitelist=&quot;10.12.0.0/16&quot; #访问数据库白名单</span></span><br><span class="line"><span class="string">loose-group_replication_single_primary_mode = on</span></span><br><span class="line"><span class="string">loose-group_replication_transaction_size_limit=1500000000</span></span><br><span class="line"><span class="string"># 组复制节点权重，权重越大，则主节点数据库异常就由集群中权重大接管主节点,建议是70-100</span></span><br><span class="line"><span class="string">loose-group_replication_member_weight=100 </span></span><br><span class="line"><span class="string">transaction_write_set_extraction = XXHASH64</span></span><br><span class="line"><span class="string">binlog_transaction_dependency_tracking  = WRITESET</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#MySQL导入和导出操作专用目录</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$BASE_DIR</span>/dumpdir  &amp;&amp; <span class="built_in">chmod</span> 755 <span class="variable">$BASE_DIR</span>/dumpdir</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改数据库管理程序的参数</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br><span class="line">sed -e <span class="string">&#x27;s/^basedir=/basedir=$&#123;MYSQL_HOME&#125;/g&#x27;</span> -e <span class="string">&#x27;s+^datadir=+datadir=$&#123;MYSQL_HOME&#125;/data+g&#x27;</span> -i <span class="variable">$&#123;MYSQL_HOME&#125;</span>/support-files/mysql.server</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysqld服务初始化，设置默认密码为空则将--initialize选项替换为--initialize-insecure选项</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br><span class="line">mysqld --initialize-insecure  --user=<span class="variable">$&#123;USER&#125;</span> --basedir=<span class="variable">$&#123;MYSQL_HOME&#125;</span> --datadir=<span class="variable">$&#123;MYSQL_HOME&#125;</span>/data --log_error=<span class="variable">$&#123;MYSQL_HOME&#125;</span>/mysql-error.log</span><br><span class="line">log_output <span class="string">&quot;mysql初始化完成(密码为空)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动mysqld服务</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile &amp;&amp;<span class="built_in">cd</span> <span class="variable">$&#123;MYSQL_HOME&#125;</span>/bin  &amp;&amp; ./mysqld start </span><br><span class="line"></span><br><span class="line"><span class="comment">#启动mysql程序</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile &amp;&amp; <span class="built_in">cd</span> <span class="variable">$&#123;MYSQL_HOME&#125;</span>/support-files &amp;&amp; ./mysql.server start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">install_mysql</span><br><span class="line">log_output <span class="string">&quot;命令行输入mysql -uroot -A 实现登录数据库&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="运行脚本"><a href="#运行脚本" class="headerlink" title="运行脚本"></a>运行脚本</h3><p><img src="/post/Shell%E8%84%9A%E6%9C%AC%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E4%BA%8C%E8%BF%9B%E5%88%B6MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220414095455346.png" alt="image-20220414095455346"></p>
<p><img src="/post/Shell%E8%84%9A%E6%9C%AC%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E4%BA%8C%E8%BF%9B%E5%88%B6MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220414095719427.png" alt="image-20220414095719427"></p>
]]></content>
      <categories>
        <category>默认分类</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
        <tag>MYSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo + Github</title>
    <url>/post/Github%20+%20Hexo%20%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本blog利用 Hexo + Github 搭建个人博客，内容包含基本工具（Node.js、Git、Github、Hexo）、利用Hexo进行发布、修改、删除文章</p>
<span id="more"></span>

<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>在开始一切之前，你必须已经：</p>
<ul>
<li>有一个github账号，没有的话去注册一个</li>
<li>安装了node.js、npm</li>
<li>安装了git for windows（或者其它git客户端）</li>
</ul>
<p>本文所使用的环境：</p>
<ul>
<li>Windows11</li>
<li><span class="exturl" data-url="bWFpbHRvOiYjeDZlOyYjMTExOyYjMTAwOyYjMTAxOyYjeDJlOyYjMTA2OyYjMTE1OyYjeDQwOyYjeDc2OyYjeDMxOyYjeDM2OyYjeDJlOyYjeDMxOyYjNTI7JiN4MmU7JiN4MzI7">&#x6e;&#111;&#100;&#101;&#x2e;&#106;&#115;&#x40;&#x76;&#x31;&#x36;&#x2e;&#x31;&#52;&#x2e;&#x32;<i class="fa fa-external-link-alt"></i></span> —— git命令行输入<code>node -v</code></li>
<li><span class="exturl" data-url="bWFpbHRvOiYjeDY3OyYjMTA1OyYjMTE2OyYjNjQ7JiN4MzI7JiN4MmU7JiN4MzM7JiN4MzM7JiN4MmU7JiN4MzA7JiM0NjsmIzExOTsmIzEwNTsmIzExMDsmIzEwMDsmI3g2ZjsmI3g3NzsmI3g3MzsmI3gyZTsmI3gzMjs=">&#x67;&#105;&#116;&#64;&#x32;&#x2e;&#x33;&#x33;&#x2e;&#x30;&#46;&#119;&#105;&#110;&#100;&#x6f;&#x77;&#x73;&#x2e;&#x32;<i class="fa fa-external-link-alt"></i></span> —— git命令行输入<code>git version</code></li>
<li><span class="exturl" data-url="bWFpbHRvOiYjeDY4OyYjeDY1OyYjMTIwOyYjMTExOyYjNjQ7JiN4MzY7JiM0NjsmIzQ5OyYjNDY7JiM0ODs=">&#x68;&#x65;&#120;&#111;&#64;&#x36;&#46;&#49;&#46;&#48;<i class="fa fa-external-link-alt"></i></span> —— git命令行输入<code>hexo -v</code>或<code>hexo version</code></li>
<li><span class="exturl" data-url="bWFpbHRvOiYjMTEwOyYjeDY1OyYjMTIwOyYjMTE2OyYjNjQ7JiN4Mzc7JiM0NjsmIzU2OyYjeDJlOyYjNDg7">&#110;&#x65;&#120;&#116;&#64;&#x37;&#46;&#56;&#x2e;&#48;<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h1 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h1><ul>
<li>安装Node.js</li>
<li>添加国内镜像源对npm加速</li>
<li>安装Git</li>
<li>注册Github</li>
<li>安装Hexo</li>
<li>连接Github与本地</li>
</ul>
<h1 id="文章基本操作"><a href="#文章基本操作" class="headerlink" title="文章基本操作"></a>文章基本操作</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 新建文章 </span><br><span class="line">hexo new post &quot;article title&quot; </span><br><span class="line"># 生成静态页面 </span><br><span class="line">hexo g </span><br><span class="line"># 本地预览 </span><br><span class="line">hexo s </span><br><span class="line"># 部署到网站 </span><br><span class="line">hexo d</span><br><span class="line"># 清空缓存并生成新的静态页面 </span><br><span class="line">hexo clean &amp;&amp; hexo g</span><br><span class="line"></span><br><span class="line">修改文章：修改对应文章内容，然后执行命令 </span><br><span class="line">hexo d -g </span><br><span class="line"></span><br><span class="line">删除文章：</span><br><span class="line">删除目录 source\_posts 下对应文章文件，然后执行命令 hexo d -g 即可。</span><br></pre></td></tr></table></figure>

<h1 id="常见配置修改"><a href="#常见配置修改" class="headerlink" title="常见配置修改"></a>常见配置修改</h1><h2 id="字数统计"><a href="#字数统计" class="headerlink" title="字数统计"></a>字数统计</h2><p>在旧版本中的post_wordcount配置似乎已经不可用，因此需要使用symbols_count_time替代</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 卸载原有依赖 不卸载对新插件有影响</span><br><span class="line">npm uninstall hexo-wordcount</span><br><span class="line"># 安装新依赖</span><br><span class="line">npm i hexo-symbols-count-time</span><br><span class="line"></span><br><span class="line">新的配置在symbols_count_time下：配置文件在主题下，themes\next\_config.yml</span><br><span class="line">symbols_count_time:</span><br><span class="line">  # 换行显示字数统计和阅读市场</span><br><span class="line">  separated_meta: true</span><br><span class="line">  # 文章底部显示</span><br><span class="line">  item_text_post: true</span><br><span class="line">  # 博客底部显示 默认为false</span><br><span class="line">  item_text_total: true</span><br></pre></td></tr></table></figure>

<h2 id="隐藏网页底部-powered-By-Hexo-x2F-强力驱动"><a href="#隐藏网页底部-powered-By-Hexo-x2F-强力驱动" class="headerlink" title="隐藏网页底部 powered By Hexo &#x2F; 强力驱动"></a>隐藏网页底部 powered By Hexo &#x2F; 强力驱动</h2><p>打开 themes&#x2F;next&#x2F;layout&#x2F;_partials&#x2F;footer.swig，找到：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% if theme.footer.powered.enable %&#125;</span><br><span class="line">&lt;div class=&quot;powered-by&quot;&gt;&#123;#</span><br><span class="line">#&#125;&#123;&#123; __(&#x27;footer.powered&#x27;, &#x27;&lt;a class=&quot;theme-link&quot; target=&quot;_blank&quot;&#x27; + nofollow + &#x27; href=&quot;https://hexo.io&quot;&gt;Hexo&lt;/a&gt;&#x27;) &#125;&#125;&#123;% if theme.footer.powered.version %&#125; v&#123;&#123; hexo_env(&#x27;version&#x27;) &#125;&#125;&#123;% endif %&#125;&#123;#</span><br><span class="line">#&#125;&lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% if theme.footer.powered.enable and theme.footer.theme.enable %&#125;</span><br><span class="line">&lt;span class=&quot;post-meta-divider&quot;&gt;|&lt;/span&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% if theme.footer.theme.enable %&#125;</span><br><span class="line">&lt;div class=&quot;theme-info&quot;&gt;&#123;#</span><br><span class="line">#&#125;&#123;&#123; __(&#x27;footer.theme&#x27;) &#125;&#125; – &#123;#</span><br><span class="line">#&#125;&lt;a class=&quot;theme-link&quot; target=&quot;_blank&quot;&#123;&#123; nofollow &#125;&#125; href=&quot;https://theme-next.org&quot;&gt;&#123;#</span><br><span class="line">#&#125;NexT.&#123;&#123; theme.scheme &#125;&#125;&#123;#</span><br><span class="line">#&#125;&lt;/a&gt;&#123;% if theme.footer.theme.version %&#125; v&#123;&#123; version &#125;&#125;&#123;% endif %&#125;&#123;#</span><br><span class="line">#&#125;&lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">把这段代码首尾分别加上：&lt;!-- 和--&gt;，或者直接删除</span><br></pre></td></tr></table></figure>

<h2 id="切换主题"><a href="#切换主题" class="headerlink" title="切换主题"></a>切换主题</h2><p>next 主题自带<strong>四种样式</strong>。<br>在主题配置文件<code>/next/_config.yml</code>中查找：<code>scheme</code>，找到如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Schemes</span><br><span class="line">#scheme: Muse</span><br><span class="line">#scheme: Mist</span><br><span class="line">#scheme: Pisces</span><br><span class="line">scheme: Gemini</span><br><span class="line">选择你喜欢的一种样式，去掉前面的 #，其他主题前加上 # 即可</span><br></pre></td></tr></table></figure>

<h2 id="代码块复制选项"><a href="#代码块复制选项" class="headerlink" title="代码块复制选项"></a>代码块复制选项</h2><p>在主题配置文件<code>next/_config.yml</code>中，搜索 codeblock，找到如下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">codeblock:</span><br><span class="line">  highlight_theme: normal</span><br><span class="line">  copy_button:  # 设置是否开启代码块复制按钮</span><br><span class="line">    enable: true</span><br><span class="line">    show_result: true  # 是否显示复制成功信息</span><br><span class="line">    # Available values: default | flat | mac</span><br><span class="line">    style:</span><br></pre></td></tr></table></figure>

<h2 id="草稿-私密博客"><a href="#草稿-私密博客" class="headerlink" title="草稿 私密博客"></a>草稿 私密博客</h2><blockquote>
<p>草稿相当于很多博客都有的“私密文章”功能。<br>$ hexo new draft “draft”<br>会在source&#x2F;_drafts目录下生成一个new-draft.md文件。但是这个文件不被显示在页面上，链接也访问不到。<br>也就是说如果你想把某一篇文章移除显示，又不舍得删除，可以把它移动到_drafts目录之中。</p>
</blockquote>
<h2 id="目录信息"><a href="#目录信息" class="headerlink" title="目录信息"></a>目录信息</h2><p>在主题配置文件<code>next/_config.yml</code>中，可以是设置展开所有目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Table of Contents in the Sidebar</span><br><span class="line"># Front-matter variable (unsupport wrap expand_all).</span><br><span class="line">toc:</span><br><span class="line">  enable: true</span><br><span class="line">  # Automatically add list number to toc.</span><br><span class="line">  number: true</span><br><span class="line">  # If true, all words will placed on next lines if header width longer then sidebar width.</span><br><span class="line">  wrap: false</span><br><span class="line">  # If true, all level of TOC in a post will be displayed, rather than the activated part of it.</span><br><span class="line">  expand_all: true</span><br><span class="line">  # Maximum heading depth of generated toc.</span><br><span class="line">  max_depth: 6</span><br></pre></td></tr></table></figure>

<h2 id="提升Hexo-NexT主题加载速度"><a href="#提升Hexo-NexT主题加载速度" class="headerlink" title="提升Hexo NexT主题加载速度"></a>提升Hexo NexT主题加载速度</h2><p>网站加载速度是影响搜索引擎排名的一个重要因素。<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vc3BlZWQvcGFnZXNwZWVkL2luc2lnaHRzLw=="># Google Page Speed Insight<i class="fa fa-external-link-alt"></i></span> 是个很好的网页性能分析工具，可以根据它的分析结果有针对性地对网页进行优化。</p>
<p><strong>优化方案</strong></p>
<p>主要尝试了下面几种方案，按效果排列，把无效的放在了后面。 <strong>关闭动效</strong> 减少动画在Mobile上的优化效果最为明显，是肉眼可见的速度提升。关闭的方法也极为简单，修改NexT的配置文件，<code>next/_config.yml</code>中，将<code>motion</code>的<code>enable</code>置为<code>false</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Use Animate.css to animate everything.</span><br><span class="line"># For more information: https://animate.style</span><br><span class="line">motion:</span><br><span class="line">  enable: false</span><br><span class="line">  async: false</span><br></pre></td></tr></table></figure>

<p>在手机上对比测试了一下，加上这个动画，页面加载确实有明显卡顿。猜想原因是多了一个动画js的render-blocking依赖，手机端的算力也偏弱。</p>
<p>把页脚的icon动效也一并去掉了：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">footer:</span><br><span class="line">  # Specify the year when the site was setup. If not defined, current year will be used.</span><br><span class="line">  #since: 2021</span><br><span class="line"></span><br><span class="line">  # Icon between year and copyright info.</span><br><span class="line">  icon:</span><br><span class="line">    # Icon name in Font Awesome. See: https://fontawesome.com/icons</span><br><span class="line">    name: fa fa-heart</span><br><span class="line">    # If you want to animate the icon, set it to true.</span><br><span class="line">    animated: false</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>默认分类</category>
      </categories>
      <tags>
        <tag>tag1</tag>
        <tag>tag2</tag>
        <tag>tag3</tag>
      </tags>
  </entry>
</search>
